MACHINE LANGUAGE ENCODER

  Write machine language with labels and macros.


USAGE

  mle < SOURCE > CODE 


LABELLED CODE EXAMPLE

  $ cat /tmp/true.src << EOF
Magic:
	90		# nop

Start:
	6a 00		# push $EXIT_SUCCESS
	5f		# pop %rdi
	6a 3c		# push $SYS_EXIT
	58		# pop %rax
	0f 05		# syscall
EOF

  $ mle < /tmp/true.src > /tmp/true
  $ chmod 755 /tmp/true
  $ ls -al /tmp/true
  -rwxr-xr-x 1 user user 9 Aug 29 19:00 /tmp/true

  $ strace /tmp/true
  execve("/tmp/true", ["/tmp/true"], 0x7ffe6b07ac50 /* 41 vars */) = 0
  open("/tmp/true", O_RDONLY)                = 3
  fstat(3, {st_mode=S_IFREG|0755, st_size=9, ...}) = 0
  mmap(NULL, 9, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE, 3, 0) = 0x7f5805d6f000
  exit(0)                                 = ?
  +++ exited with 0 +++


MACRO CODE EXAMPLE

  $ cat /tmp/false.src << EOF
[ . macro/generic ]


# -- Registers ------------------------------------------------------

[ define rax  0 ]
[ define rdi  7 ]


# -- Primitive Instruction Mnemonics --------------------------------

[ macro nop      u8 0x90 ]
[ macro push8    u8 0x6a $1 ]
[ macro pop      u8 $((0x58 + $1)) ]
[ macro syscall  u8 0x0f 05 ]


# -- Composite Instruction Mnemonics --------------------------------

[ macro mov8r64   push8 $1; pop $2 ]
[ macro syscall8  mov8r64 $1 rax; syscall ]


# -- Unlucky Numbers ------------------------------------------------

[ define EXIT_FAILURE   1 ]
[ define SYS_EXIT      60 ]


# -- Code -----------------------------------------------------------

Magic:
	[ nop ]

Start:
	[ mov8r64 EXIT_FAILURE rdi ]
	[ syscall8 SYS_EXIT ]
EOF

  $ mle < /tmp/false.src > /tmp/false
  $ chmod 755 /tmp/false
  $ ls -al /tmp/false
  -rwxr-xr-x 1 user user 9 Aug 29 18:57 /tmp/false

  $ strace /tmp/false
  execve("/tmp/false", ["/tmp/false"], 0x7ffd5cde5a70 /* 41 vars */) = 0
  open("/tmp/false", O_RDONLY)            = 3
  fstat(3, {st_mode=S_IFREG|0755, st_size=9, ...}) = 0
  mmap(NULL, 9, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE, 3, 0) = 0x7f4a62d5c000
  exit(1)                                 = ?
  +++ exited with 1 +++


SEE ALSO

  http://github.com/jhswartz/mli
  http://github.com/jhswartz/mlx


AUTHOR

  Justin Swartz <justin.swartz@risingedge.co.za>
